# –ü–ª–∞–Ω: –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ ¬´–°–∞–º–±–∞–Ω–¥—Ö–∞¬ª (Referral System MVP)

> **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ (MVP)  
> **–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2026-02-05  
> **–°–≤—è–∑–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç:** [docs/monetization-lakshmani.md - –†–∞–∑–¥–µ–ª 3](./monetization-lakshmani.md)

---

## 1. –û–±–∑–æ—Ä (Overview)

**–¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Ä–æ—Å—Ç–∞ –±–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.
**–ú–µ—Ö–∞–Ω–∏–∫–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–∏–≥–ª–∞—à–∞—é—Ç –¥—Ä—É–∑–µ–π, –ø–æ–ª—É—á–∞—é—Ç LKM –∑–∞ –∏—Ö "–∞–∫—Ç–∏–≤–∞—Ü–∏—é" (–ø–æ–ª–µ–∑–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è).
**–§–∏–ª–æ—Å–æ—Ñ–∏—è:** "–ù–µ—Ç –Ω–∞–≥—Ä–∞–¥ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é, –µ—Å—Ç—å –Ω–∞–≥—Ä–∞–¥–∞ –∑–∞ —Å–≤—è–∑—å (Sambandha)".

---

## 2. –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ (Success Criteria)

| # | –ö—Ä–∏—Ç–µ—Ä–∏–π | –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å |
|---|----------|---------------|
| 1 | –£ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–≤–∞–π—Ç-–∫–æ–¥/—Å—Å—ã–ª–∫–∞ | DB check: –ø–æ–ª–µ `invite_code` —É –≤—Å–µ—Ö —é–∑–µ—Ä–æ–≤ |
| 2 | –ù–æ–≤—ã–π —é–∑–µ—Ä –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å –ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–∏–º | DB check: –ø–æ–ª–µ `referrer_id` –∑–∞–ø–æ–ª–Ω–µ–Ω–æ |
| 3 | –≠–∫—Ä–∞–Ω "–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å" –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç QR –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É | UI check: –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å -> –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–∑–µ–π |
| 4 | –ü—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è —Ä–µ—Ñ–µ—Ä–∞–ª–æ–º –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è 50 Pending LKM | Wallet check: –±–∞–ª–∞–Ω—Å —Ä–µ—Ñ–µ—Ä–∞–ª–∞ –≤—ã—Ä–æ—Å |
| 5 | –ü—Ä–∏ "–ê–∫—Ç–∏–≤–∞—Ü–∏–∏" (—Ç—Ä–∞—Ç–∞ LKM) –ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–∏–π –ø–æ–ª—É—á–∞–µ—Ç 100 Active LKM | Wallet check: –±–∞–ª–∞–Ω—Å –ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–µ–≥–æ –≤—ã—Ä–æ—Å |

---

## 3. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Backend:** Go + Fiber (User/Wallet Service).
- **Database:** PostgreSQL (–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ `users` —Å –ø–æ–ª—è–º–∏ referral).
- **Frontend:** React Native (Deep Links, Share API, QR Code).

---

## 4. –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### Backend ‚úÖ
```
server/
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.go              # ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è InviteCode, ReferrerID, ReferralStatus
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ referral_service.go  # ‚úÖ –õ–æ–≥–∏–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –Ω–∞–≥—Ä–∞–¥
‚îÇ   ‚îî‚îÄ‚îÄ handlers/
‚îÇ       ‚îú‚îÄ‚îÄ auth_handler.go      # ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è invite_code –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îÇ       ‚îî‚îÄ‚îÄ referral_handler.go  # ‚úÖ API: GetInviteLink, GetStats, GetReferrals
```

### Frontend ‚úÖ
```
frontend/
‚îú‚îÄ‚îÄ screens/
‚îÇ   ‚îî‚îÄ‚îÄ portal/referral/
‚îÇ       ‚îî‚îÄ‚îÄ InviteFriendsScreen.tsx  # ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω —Å QR, Share, Stats
‚îú‚îÄ‚îÄ App.tsx                          # ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ä–æ—É—Ç InviteFriends
‚îî‚îÄ‚îÄ types/navigation.ts              # ‚úÖ –¢–∏–ø–∏–∑–∞—Ü–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
```

---

## 5. –†–∞–∑–±–∏–≤–∫–∞ –∑–∞–¥–∞—á (Task Breakdown)

### –§–∞–∑–∞ 1: Backend & Data ‚úÖ

#### Task 1.1: Schema & Models ‚úÖ
- **Agent:** `backend-specialist`
- **Skill:** `database-design`
- **Output:**
    - ‚úÖ –ü–æ–ª–µ `invite_code` –≤ `users` (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).
    - ‚úÖ –ü–æ–ª–µ `referrer_id` –≤ `users`.
    - ‚úÖ –ü–æ–ª–µ `referral_status` –≤ `users` (pending/active).
    - ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–æ–≤ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.

#### Task 1.2: Registration Flow with Invite ‚úÖ
- **Agent:** `backend-specialist`
- **Skill:** `api-patterns`
- **Output:**
    - ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ `invite_code` –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.
    - ‚úÖ –ü—Ä–∏–≤—è–∑–∫–∞ `referrer_id`.
    - ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è invite_code –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

#### Task 1.3: Referral Service (Rewards) ‚úÖ
- **Agent:** `backend-specialist`
- **Skill:** `clean-code`
- **Output:**
    - ‚úÖ –ú–µ—Ç–æ–¥ `ProcessProfileCompletion(userID)` -> –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ 50 Pending —Ä–µ—Ñ–µ—Ä–∞–ª—É.
    - ‚úÖ –ú–µ—Ç–æ–¥ `ProcessActivation(userID)` -> –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ 100 Active –ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–µ–º—É.
    - ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `WalletService.AddBonus()`.
    - ‚úÖ API endpoints: `/referral/invite`, `/referral/stats`, `/referral/list`.

---

### –§–∞–∑–∞ 2: Frontend UI ‚úÖ

#### Task 2.1: Invite Screen Logic ‚úÖ
- **Agent:** `mobile-developer`
- **Skill:** `mobile-design`
- **Output:**
    - ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ Deep Link / Invite Code —Ç–µ–∫—É—â–µ–≥–æ —é–∑–µ—Ä–∞.
    - ‚úÖ –≠–∫—Ä–∞–Ω InviteFriendsScreen —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∏–∑–∞–π–Ω–æ–º.

#### Task 2.2: QR & Share ‚úÖ
- **Agent:** `mobile-developer`
- **Skill:** `mobile-design`
- **Output:**
    - ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR –∫–æ–¥–∞ (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `react-native-qrcode-svg`).
    - ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" —Å Share API.
    - ‚úÖ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞.

#### Task 2.3: Referral List & Stats ‚úÖ
- **Agent:** `mobile-developer`
- **Skill:** `mobile-design`
- **Output:**
    - ‚úÖ –°–ø–∏—Å–æ–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö —Å –∏—Ö —Å—Ç–∞—Ç—É—Å–æ–º (Pending/Active).
    - ‚úÖ –°—á–µ—Ç—á–∏–∫: –ø—Ä–∏–≥–ª–∞—à–µ–Ω–æ, –∞–∫—Ç–∏–≤–Ω—ã—Ö, –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ LKM.

---

### –§–∞–∑–∞ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Deep Links ‚úÖ

#### Task 3.1: Deep Linking Configuration
- **Agent:** `mobile-developer`
- **Skill:** `app-builder`
- **Status:** ‚úÖ Completed
- **Output:** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `linking` –≤ React Navigation –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Å—ã–ª–æ–∫ –≤–∏–¥–∞ `vedamatch://invite/{code}` –∏ `vedamatch://portal/{tab}`.

---

## 6. –ì—Ä–∞—Ñ–∏–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```mermaid
graph TD
    T1.1[Schema ‚úÖ] --> T1.2[Registration Flow ‚úÖ]
    T1.1 --> T1.3[Referral Service ‚úÖ]
    T1.1 --> T1.3[Referral Service ‚úÖ]
    T1.2 --> T3.1[Deep Links ‚úÖ]
    T1.3 --> T2.3[Stats UI ‚úÖ]
    T3.1 --> T2.2[QR Share ‚úÖ]
```

---

## 7. –†–∏—Å–∫–∏
- **–§—Ä–æ–¥:** –ù–∞–∫—Ä—É—Ç–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ (—Å–∞–º–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è).
    - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è:* –ù–∞–≥—Ä–∞–¥–∞ –ø—Ä–∏–≥–ª–∞—à–∞—é—â–µ–º—É –¢–û–õ–¨–ö–û –∑–∞ "–ê–∫—Ç–∏–≤–∞—Ü–∏—é" (—Ç—Ä–∞—Ç—É –¥–µ–Ω–µ–≥/—É—Å–ª—É–≥—É), –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∑–∞ –≤—Ö–æ–¥.

---

## 8. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Backend
| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `server/internal/models/user.go` | –ü–æ–ª—è InviteCode, ReferrerID, ReferralStatus, Referrer |
| `server/internal/services/referral_service.go` | –ü–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã |
| `server/internal/handlers/referral_handler.go` | API —Ö–µ–Ω–¥–ª–µ—Ä—ã |
| `server/internal/handlers/auth_handler.go` | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ |
| `server/cmd/api/main.go` | –†–æ—É—Ç—ã –¥–ª—è /referral/* |

### Frontend
| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `frontend/screens/portal/referral/InviteFriendsScreen.tsx` | –≠–∫—Ä–∞–Ω –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –¥—Ä—É–∑–µ–π |
| `frontend/App.tsx` | –†–æ—É—Ç InviteFriends |
| `frontend/types/navigation.ts` | –¢–∏–ø –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ |

---

## ‚úÖ MVP –ó–ê–í–ï–†–®–ï–ù

## ‚úÖ PHASE 2 –ó–ê–í–ï–†–®–ï–ù–ê
1. **Universal Links:** –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `https://vedamatch.ru` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Apple/Google App Site Association. ‚úÖ
2. **Push Notifications:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ –±–æ–Ω—É—Å–æ–≤ –∏ —É—Å–ø–µ—Ö–∞—Ö –¥—Ä—É–∑–µ–π. ‚úÖ
3. **Analytics Dashboard:** –î–∞—à–±–æ—Ä–¥ —ç–∫–æ–Ω–æ–º–∏–∫–∏ –∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ. ‚úÖ
4. **Fraud Detection:** –ó–∞—â–∏—Ç–∞ –ø–æ DeviceID (Fingerprinting) –Ω–∞ –±—ç–∫–µ–Ω–¥–µ –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ. ‚úÖ

---

## üöÄ PHASE 3: –í–∏—Ä–∞–ª—å–Ω–æ—Å—Ç—å –∏ UX (–í —Ä–∞–±–æ—Ç–µ)
1. **Social Sharing Pro:** –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `react-native-share` –¥–ª—è –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤ (WA, TG) —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø—Ä–µ–≤—å—é.
2. **Invite Card Generator:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫—Ä–∞—Å–∏–≤—ã—Ö –∏–º–∏–¥–∂–µ–π (–±–∞–Ω–Ω–µ—Ä–æ–≤) –¥–ª—è —Å—Ç–æ—Ä–∏—Å/–ø–æ—Å—Ç–æ–≤ —Å QR-–∫–æ–¥–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
3. **OpenGraph Support:** –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–µ—Ç–∞-—Ç–µ–≥–æ–≤ –¥–ª—è —Å—Å—ã–ª–æ–∫ `vedamatch.ru/invite/XXX` (–∫—Ä–∞—Å–∏–≤–æ–µ –ø—Ä–µ–≤—å—é –≤ Telegram/WhatsApp).
4. **Referral Progress:** –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Ç–∏ –¥—Ä—É–≥–∞ –∫ "–ê–∫—Ç–∏–≤–∞—Ü–∏–∏" –≤ —Å–ø–∏—Å–∫–µ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤.
