# Specification: Sattva Market & Ecosystem

## 1. Обзор
Реализация комплексной системы "Sattva Market" внутри платформы. Система позволяет пользователям создавать магазины, размещать физические и цифровые товары, управлять заказами и взаимодействовать с покупателями через существующий мессенджер. Включает глубокую интеграцию с AI (Кришнадас) для поиска и рекомендаций, а также геолокационные сервисы.

## 2. Функциональные Требования

### 2.1. Управление Магазином (Shop Management)
*   **Создание магазина:**
    *   Обычный пользователь: Ограничение 1 магазин на аккаунт (требуется подписка - проверка прав).
    *   Администратор: Бесплатно, без ограничений по количеству.
    *   Поля: Название, Описание, Логотип, Обложка, Категория (вид магазина), Город, Точный адрес (координаты для карты), График работы, Ссылки (сайт, соцсети).
*   **Админка Продавца (в приложении):**
    *   Статистика продаж (просмотры, заказы, доход).
    *   Управление списком товаров.
    *   Настройки магазина.

### 2.2. Управление Товарами (Product Management)
*   **Карточка товара:**
    *   Название, Краткое/Полное описание.
    *   Категория, Теги.
    *   Медиа: Галерея изображений.
    *   Тип товара: Физический или Цифровой (ссылка/файл).
    *   Внешняя ссылка (опционально: купить на стороннем сайте).
*   **Вариативность (SKU) и Учет:**
    *   Конструктор вариантов: Цвет, Размер, Материал и др.
    *   Управление ценой и остатком (Stock) для каждой комбинации (SKU).
    *   Автоматическое списание остатков при заказе. Блокировка покупки, если `stock=0`.

### 2.3. Поиск и Витрина (Discovery)
*   **Фильтрация:** 
    *   По городу (выбор из списка или автоопределение).
    *   По виду магазина (категории: еда, одежда, книги и т.д.).
    *   По товарам: цена, наличие, тип доставки, рейтинг.
*   **Геолокация и Карты:**
    *   Карта магазинов: отображение всех активных точек.
    *   **Навигация:** Кнопка "Как добраться/Пройти к магазину" (открытие внешних карт: Google, Yandex, Apple с построенным маршрутом).
    *   Фильтр "Рядом со мной".

### 2.4. Заказы и Коммуникация (Messenger Integration)
*   **Покупка:** Корзина, выбор адреса доставки/самовывоза.
*   **Уведомления Продавцу:**
    *   Используется существующий сервис комнат (`rooms`).
    *   При создании магазина создается "Техническая комната магазина".
    *   При новом заказе/вопросе: Бот присылает уведомление в техническую комнату.
    *   Содержание уведомления: Детали заказа + **Ссылка на контакт покупателя** (Deep link в сервис `contacts` для начала личного чата).

### 2.5. AI Интеграция (RAG + Krishnadas)
*   **Индексация:** Товары и Магазины индексируются в векторной базе данных (через Python RAG сервис).
*   **Function Calling (Активный поиск):** ИИ в чате может распознать намерение "купить/найти" и выполнить поиск по базе товаров, вернув карточки товаров прямо в диалог.
*   **Навигатор:** ИИ подсказывает, в каком разделе или магазине искать определенные вещи.
*   **Проактивный агент:** Фоновый анализ предпочтений пользователя. Если появляется релевантный товар, ИИ может инициировать уведомление.

## 3. Нефункциональные Требования
*   **Производительность:** Быстрый поиск товаров.
*   **Локализация:** Полная поддержка RU/EN.
*   **Безопасность:** Строгое разграничение прав доступа.

## 4. Технический Стек
*   **Backend:** Go (Fiber, GORM). Таблицы: `shops`, `products`, `variants`, `orders`, `reviews`.
*   **AI Backend:** Python. Обновление RAG пайплайна для индексации товаров. Добавление Tools для LLM.
*   **Mobile:** React Native. Новые экраны: ShopCreate, SellerDashboard, ProductDetails, Cart, ShopMap.
