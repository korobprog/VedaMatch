# Спецификация трека: Единый Гео-Сервис (Map Service)

## 1. Обзор
Создание централизованного картографического сервиса, объединяющего данные из всех ключевых модулей приложения (VedaMatch, Market, Ads, Events). Сервис предоставляет пользователям интерактивную карту для поиска единомышленников, товаров и услуг с поддержкой глубокой интеграции AI-ассистента.

## 2. Основные возможности (Scope)

### 2.1. Интерактивная Карта
- **Движок:** React Native Maps + Geoapify Tiles.
- **Слои данных (Layers):** Возможность включать/отключать отображение:
    - Пользователи (VedaMatch).
    - Магазины и Кафе (Market).
    - Объявления (Ads).
    - *События (Future Scope).*
- **Кластеризация:** Агрегация объектов в группы (кружки с цифрами) при уменьшении масштаба для предотвращения перегрузки карты.
- **Поиск:**
    - Текстовый поиск по названию объектов.
    - Гео-поиск (перемещение карты к искомому объекту).

### 2.2. Карточки объектов и Навигация
- **UI Взаимодействия:** При клике на маркер открывается **Bottom Sheet** (полушторка) с краткой информацией.
- **Содержимое карточки:** Фото, Название, Рейтинг, Расстояние, Действия (Написать, Подробнее).
- **Маршрутизация:** Построение пешего или автомобильного маршрута от текущей точки до объекта прямо внутри приложения (Geoapify Routing API).

### 2.3. AI-Интеграция (Sattva Assistant)
- **Контекстный поиск:** Ассистент в чате может обрабатывать запросы вида "Где ближайшее вегетарианское кафе?" или "Найди друзей в этом районе".
- **Визуализация:** Ассистент может возвращать интерактивные виджеты карты или ссылки, открывающие карту в нужном месте с примененными фильтрами.
- **Сложные запросы:** "Найди магазины специй рядом с храмом" (комбинированный поиск).

### 2.4. Фильтрация
- Глобальные фильтры (по типу объекта).
- Детальные фильтры внутри категорий (например, только "Веганские" кафе или "Продажа" в объявлениях).

### 2.5. Админ-панель (Next.js)
- **Управление Картой:** Просмотр глобальной карты в админке с правами администратора.
- **Модерация:** Возможность принудительно скрыть любой маркер (объявление, магазин, пользователя) с карты без удаления самого объекта.
- **Конфигурация:** Настройка соответствия категорий и иконок/цветов маркеров.
- **Мониторинг:** Отображение статуса подключения к Geoapify и статистики запросов.

## 3. Технические требования

### Backend (Go)
- **API Aggregator:** Эндпоинт `/api/map/search` объединяющий данные из `users`, `shops`, `ads`.
- **Geo-Query:** Оптимизированные запросы к БД (PostGIS или расчет расстояний) для выборки объектов в видимой области (Bounding Box).
- **Proxy:** Проксирование запросов к Geoapify для защиты API ключей.

### Frontend (React Native)
- Использование компонентов карты с кастомной стилизацией (Vedic Theme).
- State Management для управления активными слоями и фильтрами.

## 4. Критерии приемки (Acceptance Criteria)
1.  Карта отображается, тайлы Geoapify грузятся корректно.
2.  Пользователь может переключать слои (Люди/Магазины/Объявления).
3.  При отдалении объекты собираются в кластеры.
4.  Клик по маркеру открывает Bottom Sheet с корректными данными.
5.  Маршрут строится от текущей локации до маркера.
6.  AI-ассистент корректно отвечает на гео-запросы и может направить на экран карты.
7.  Админ может просматривать карту и скрывать маркеры.

## 5. Исключения (Out of Scope)
- Навигация в реальном времени (ведение по маршруту с голосом) — используется только отображение линии маршрута.
- 3D модели зданий.
